; ==============================================================================
; PHP Configuration for Laravel Application
; ==============================================================================
; Purpose: Production-ready settings with free-tier optimization
; Environment: Development & Production (override via environment vars)
; ==============================================================================

[PHP]
; -------------------------------------------------------------------------
; Core Settings
; -------------------------------------------------------------------------

; Character encoding
default_charset = "UTF-8"

; Error reporting
; Development: E_ALL
; Production: E_ALL & ~E_DEPRECATED & ~E_STRICT
error_reporting = E_ALL
display_errors = Off
display_startup_errors = Off
log_errors = On
error_log = /var/log/php/error.log

; -------------------------------------------------------------------------
; Performance & Resource Limits
; -------------------------------------------------------------------------

; Execution time (seconds)
max_execution_time = 60
max_input_time = 60

; Memory limit (free-tier: 256M, production: 512M+)
memory_limit = 256M

; Upload limits (for webhook payloads, CI artifacts)
upload_max_filesize = 20M
post_max_size = 25M
max_file_uploads = 20

; -------------------------------------------------------------------------
; Session Configuration
; -------------------------------------------------------------------------

; Use Redis for sessions (configured via Laravel)
session.save_handler = redis
session.save_path = "tcp://redis:6379"

; Session security
session.use_strict_mode = 1
session.use_cookies = 1
session.use_only_cookies = 1
session.cookie_httponly = 1
session.cookie_secure = 0  ; Set to 1 in production with HTTPS
session.cookie_samesite = "Lax"

; Session lifetime (2 hours)
session.gc_maxlifetime = 7200
session.cookie_lifetime = 7200

; -------------------------------------------------------------------------
; Security
; -------------------------------------------------------------------------

; Disable dangerous functions
disable_functions = passthru,system,curl_multi_exec,parse_ini_file,show_source
; Hide PHP version in headers
expose_php = Off

; Prevent file uploads to arbitrary locations
file_uploads = On
upload_tmp_dir = /tmp

; -------------------------------------------------------------------------
; OPcache Configuration (see opcache.ini for detailed settings)
; -------------------------------------------------------------------------
opcache.enable = 1
opcache.enable_cli = 0  ; Disable for CLI to avoid issues with artisan commands

; -------------------------------------------------------------------------
; Date & Timezone
; -------------------------------------------------------------------------
date.timezone = UTC

; -------------------------------------------------------------------------
; Output Buffering
; -------------------------------------------------------------------------
output_buffering = 4096
implicit_flush = Off

; -------------------------------------------------------------------------
; Realpath Cache (performance optimization)
; -------------------------------------------------------------------------
realpath_cache_size = 4096k
realpath_cache_ttl = 600

; -------------------------------------------------------------------------
; Variable Limits
; -------------------------------------------------------------------------
max_input_vars = 5000
max_input_nesting_level = 64

; -------------------------------------------------------------------------
; Mail Configuration (Laravel handles this)
; -------------------------------------------------------------------------
SMTP = localhost
smtp_port = 25
sendmail_path = /usr/sbin/sendmail -t -i

; -------------------------------------------------------------------------
; Extension-Specific Settings
; -------------------------------------------------------------------------

[MySQLi]
mysqli.max_persistent = -1
mysqli.allow_persistent = On
mysqli.max_links = -1
mysqli.default_port = 3306
mysqli.reconnect = Off

[PDO_MySQL]
pdo_mysql.default_socket = /var/run/mysqld/mysqld.sock

[Redis]
redis.session.locking_enabled = 1
redis.session.lock_retries = -1
redis.session.lock_wait_time = 10000